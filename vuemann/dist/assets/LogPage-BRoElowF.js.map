{"version":3,"file":"LogPage-BRoElowF.js","sources":["../../src/services/log/init/log-service.js","../../src/views/servicesPage/LogPage.vue"],"sourcesContent":["import { servicesM } from '@brugmann/vuemann/src/services/services-manager.js';\r\nimport { req, auth } from '@brugmann/vuemann/src/services/services-helper.js';\r\nimport { ConfigLoader } from '@brugmann/vuemann/src/config/config-loader.js';\r\n \r\nconst send = async (error, context = {}) => {\r\n  if(import.meta.env[`VITE_ENV`] === 'dev') { return }\r\n\r\n  if(!servicesM.service('router:hasApiRoute', 'log')) {\r\n    // eslint-disable-next-line no-console\r\n    console.error(error, context)\r\n    // eslint-disable-next-line no-console\r\n    console.error('La route \"log\" n\\'est pas configurée pour les API routes')\r\n    return\r\n  }\r\n\r\n  await req('log',  {\r\n    date: new Date().toISOString(),\r\n    app: ConfigLoader.get('app.name'),\t\r\n    version: __APP_VERSION__,\r\n    user: auth.user(),\r\n    message: typeof error === 'string' ? error : (error.message || JSON.stringify(error)),\r\n    ...context,\r\n    stack: error && error.stack ? error.stack : undefined\r\n  }, {log: false});\r\n} \r\n\r\nexport const logService = { send }","<script setup>\r\nimport { ref } from 'vue'\r\nimport { logService } from '@brugmann/vuemann/src/services/log/init/log-service.js'\r\n\r\nconst logSent = ref(false)\r\nconst logTrigger = ref(false)\r\n\r\nconst triggerLog = async () => {\r\n  logTrigger.value = true\r\n  // eslint-disable-next-line no-undef\r\n  nonExistentVar.value = 'test'\r\n\r\n}\r\n\r\nconst trifferSendLog = async () => {\r\n  await logService.send('Erreur de test déclenchée depuis la doc', { module: 'Demo' })\r\n  logSent.value = true\r\n}\r\n</script>\r\n\r\n\r\n<template>\r\n  <h1 class=\"h1\">Service Log</h1>\r\n  <p>\r\n    Le service <b>log</b> permet de centraliser la gestion des erreurs dans l'application VueJS. Il loggue les erreurs en console et les envoie \r\n    à une route API nommée <span class=\"badge-code\">log</span>.\r\n  </p>\r\n  <p>\r\n    <i class=\"fa-solid fa-triangle-exclamation color-danger mr-5\"></i>\r\n    Ce service n'est pas activé en environnement de développement.\r\n    <i class=\"fa-solid fa-triangle-exclamation color-danger ml-5\"></i>\r\n  </p>\r\n  <h2 class=\"h2\">Installation</h2>\r\n  <ul class=\"list ml-25\">\r\n    <li>Déclarez la route <span class=\"badge-code\">log</span> dans votre configuration d'API.</li>\r\n    <li class=\"my-10\">Importez et utilisez le <span class=\"badge-code\">logPlugin</span> dans votre <span class=\"badge-code\">main.js</span> pour capturer automatiquement les erreurs VueJS.</li>\r\n    <li>Importez le service <span class=\"badge-code\">logService</span> services situé dans le fichier main.js.</li>\r\n  </ul>\r\n  <h2 class=\"h2\">Fonctionnement</h2>\r\n  <p>\r\n    Si la route <span class=\"badge-code\">log</span> n'est pas configurée, l'erreur est seulement affichée en console.<br />\r\n    Si la route existe, l'erreur (message, stack, contexte) est envoyée en POST à <span class=\"badge-code\">/log</span>.\r\n  </p>\r\n  <h2 class=\"h2\">Méthodes accessibles</h2>\r\n  <h3 class=\"h3\"><i class=\"fa-solid fa-diamond mr-5\"></i>send</h3>\r\n  <p>\r\n    Permet d'envoyer une erreur au backend et de la logguer en console.\r\n  </p>\r\n  <h4 class=\"h4\">Paramètres</h4>\r\n  <table class=\"t-default\">\r\n    <thead>\r\n      <tr>\r\n        <th>Nom</th>\r\n        <th>Type</th>\r\n        <th>Obligatoire</th>\r\n        <th>Default</th>\r\n        <th>Description</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>error</td>\r\n        <td>String | Object</td>\r\n        <td>oui</td>\r\n        <td>-</td>\r\n        <td>L'erreur à logguer (string ou instance d'Error)</td>\r\n      </tr>\r\n      <tr>\r\n        <td>context</td>\r\n        <td>Object</td>\r\n        <td>non</td>\r\n        <td>{}</td>\r\n        <td>Contexte additionnel à envoyer (ex: infos utilisateur, module...)</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n  <h4 class=\"h4\">Exemple</h4>\r\n  <div class=\"div-code mb-10\">\r\n    //utilisation avec le service manager<br />\r\n    import { servicesM } from \"@brugmann/vuemann/src/services/services-manager.js\";<br />\r\n    servicesM.service('log:send', [error, context]);<br />\r\n    //utilisation avec le helper<br /><br />\r\n    import { log } from \"@brugmann/vuemann/src/services/services-helper.js\";<br />\r\n    log.send(error, context);\r\n  </div>\r\n  <div class=\"d-flex g-25\">\r\n    <div class=\"f-column flex-1 text-center\">\r\n      <button class=\"btn btn-primary\" @click=\"trifferSendLog\">Déclencher l'envoi d'un log d'erreur</button>\r\n      <span v-if=\"logSent\" class=\"ml-10\">Erreur envoyée !</span>\r\n    </div>\r\n    <div class=\"f-column flex-1 text-center\">\r\n      <button class=\"btn btn-primary\" @click=\"triggerLog\">Déclencher un log d'erreur</button>\r\n      <span v-if=\"logTrigger\" class=\"ml-10\">Erreur déclenchée !</span>\r\n    </div>\r\n  </div>\r\n  <h2 class=\"h2\">Lire les logs en production</h2>\r\n  <p>\r\n    Les fichiers de l'application étant minifiés en production, vous ne pourrez pas retrouver la localisation des erreurs facilement.\r\n    Suivez cette procédure pour lire les logs sur <router-link to=\"/debug\" class=\"link-underline\">la page de debug</router-link>.\r\n  </p>\r\n</template>\r\n"],"names":["send","error","context","logService","logSent","ref","logTrigger","triggerLog","trifferSendLog","_createElementVNode","_hoisted_1","_hoisted_2","_createElementBlock","_hoisted_3","_hoisted_4","_hoisted_5","_cache","_createVNode","_component_router_link"],"mappings":"yGAIA,MAAMA,EAAO,MAAOC,EAAOC,EAAU,KAAO,CAoB5C,EAEaC,EAAa,CAAE,KAAAH,CAAA,uLCtB5B,MAAMI,EAAUC,EAAI,EAAK,EACnBC,EAAaD,EAAI,EAAK,EAEtBE,EAAa,SAAY,CAC7BD,EAAW,MAAQ,GAEnB,eAAe,MAAQ,MAEzB,EAEME,EAAiB,SAAY,CACjC,MAAML,EAAW,KAAK,0CAA2C,CAAE,OAAQ,MAAM,CAAE,EACnFC,EAAQ,MAAQ,EAClB,qxEAoEEK,EASM,MATNC,EASM,CARJD,EAGM,MAHNE,EAGM,CAFJF,EAAqG,SAAA,CAA7F,MAAM,kBAAmB,QAAOD,GAAgB,sCAAoC,EAChFJ,EAAA,WAAZQ,EAA0D,OAA1DC,EAAmC,kBAAgB,cAErDJ,EAGM,MAHNK,EAGM,CAFJL,EAAuF,SAAA,CAA/E,MAAM,kBAAmB,QAAOF,GAAY,4BAA0B,EAClED,EAAA,WAAZM,EAAgE,OAAhEG,EAAsC,qBAAmB,gBAG7DC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAP,EAA+C,KAAA,CAA3C,MAAM,IAAI,EAAC,8BAA2B,EAAA,GAC1CA,EAGI,IAAA,KAAA,eAHD,oLAE6C,EAAA,GAAAQ,EAA8EC,EAAA,CAAjE,GAAG,SAAS,MAAM,6BAAiB,IAAgB,CAAA,GAAAF,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAAhB,mBAAgB,EAAA,0BAAc,KAC9H,EAAA"}