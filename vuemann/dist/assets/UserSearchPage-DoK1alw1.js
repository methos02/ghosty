import{_ as M}from"./InputSearchComponent-CAzxQHbS.js";import{_ as L}from"./PaginatorComponent-BvQ1Ccny.js";import{e as x,f as D,S as P,g as p,h as U,c as g,o as v,a as l,b as f,u as w,t as k,w as b,i as N,j as R,k as $,l as B,d as F,F as V,m as O}from"./index-CFtw_ocM.js";import{_ as E}from"./CodeHtmlComponent-DrC0t-WB.js";const q=(t,a=!1)=>{const i={id:t.id,username:t.username,lastname:t.lastname,firstname:t.firstname,fullname:j(t.lastname,t.firstname),email:t.email};return a&&(i.groups=(t.groups??[]).map(n=>({id:n.group.id,name:n.group.name,description:n.group.description,levels:n.group.level??[]}))),i},j=(t,a)=>t.toUpperCase()+" "+x(a),A={userSearchLastname:async t=>D("user.search.lastname",{params:t}),userSearch:async t=>D("user.search",{params:t,"no-flash":[P.NOT_FOUND]})},z={userSearch:async(t,a)=>{const i=a.typeSearch==="username"?await A.userSearch({substring:t,skip:a.skip,limit:a.limit}):await A.userSearchLastname({substring:t,skip:a.skip,limit:a.limit});if(i.status!==P.SUCCESS)return{users:[]};const n=i.data.items.map(o=>q(o,a.groups));return delete i.data.items,{users:n,paginator:i.data}}},G={class:"user-search-container"},Z={class:"form-group"},H=["title"],J={"data-total":"",class:"result-total | ml-10 fw-700 color-primary-300"},K={class:"users-list | f-column g-5 my-5"},Q={__name:"UserSearchComponent",props:{modelValue:{type:Object,required:!0},groups:{type:Boolean,default:!1},count:{type:Number,default:void 0},callback:{type:Function,default:void 0}},emits:["update:modelValue"],setup(t,{expose:a,emit:i}){const n=t,o=p(""),e=p([]),r=p();U(()=>e.value,s=>{r.value.toggleDropdown(s.length>0)}),U(()=>o.value,s=>{s.length===0&&(e.value=[])});const m=p("fullname"),S=async()=>{m.value=m.value==="username"?"fullname":"username",o.value="",e.value=[],d.value={skip:0,limit:20},r.value.focus()},d=p({skip:0,limit:20}),_=async(s,u=d.value.skip,y=d.value.limit)=>{const C={skip:u,limit:y,groups:n.groups,typeSearch:m.value},h=n.callback?await n.callback(s,C):await z.userSearch(s,C);return h===null?[]:(u===0&&(e.value=[]),e.value.push(...h.users),h.paginator?.skip!==void 0&&(d.value=h.paginator),h.users)},I=async(s,u)=>{o.value.length!==0&&await _(o.value,s+u,u)};a({toggleDropdown:s=>{r.value.toggleDropdown(s)},setSearch:s=>{r.value.setSearch(s)}});const T=i;return U(e,s=>{T("update:modelValue",s)}),(s,u)=>(v(),g("div",G,[l("div",Z,[l("button",{id:"user_search_switch",type:"button",class:"btn btn-primary",onClick:S,title:w(k)("user_search.switch_search_title")},[...u[1]||(u[1]=[l("i",{class:"fa-solid fa-repeat"},null,-1)])],8,H),f(M,{ref_key:"inputSearch",ref:r,name:"user_search",class:"user-search-input",cb:_,pattern:/^[a-zA-Z\s]+$/,label:w(k)(`user_search.search_${m.value}_label`),displayError:!1,modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=y=>o.value=y)},{default:b(()=>[f(L,{"data-users":"",type:"infinite",params:d.value,cb:I},{default:b(()=>[l("p",J,N(w(k)("user_search.users_found",{count:d.value.total})),1),l("ul",K,[R(s.$slots,"default")])]),_:3},8,["params"])]),_:3},8,["label","modelValue"])]),f($,{name:"user_search"})]))}},W={class:"my-15"},X=300,Y=20,le={__name:"UserSearchPage",setup(t){const a=p([]),i=[{id:1,username:"marpau",fullname:"MARTIN Paul"},{id:2,username:"marsop",fullname:"MARTIN Sophie"},{id:3,username:"marluc",fullname:"MARTIN Luc"},{id:4,username:"marann",fullname:"MARTIN Anne"},{id:5,username:"marpie",fullname:"MARTIN Pierre"},{id:6,username:"marcla",fullname:"MARTIN Claire"},{id:7,username:"dubpau",fullname:"DUBOIS Paul"}],n=async(o,e)=>{await new Promise(c=>setTimeout(c,X));const{skip:r=0,limit:m=Y,typeSearch:S}=e,d=i.filter(c=>S==="username"?c.username.toLowerCase().includes(o.toLowerCase()):c.fullname.toLowerCase().includes(o.toLowerCase()));return{users:d.slice(r,r+m).map(c=>({id:c.id,username:c.username,fullname:c.fullname})),paginator:{skip:r,limit:m,total:d.length}}};return(o,e)=>(v(),g(V,null,[e[2]||(e[2]=B('<h1 class="h1">UserSearch Component - API Users</h1><p class="my-10"> Ce composant permet de rechercher des utilisateurs avec une interface de recherche interactive. Il offre la possibilité de rechercher par nom complet ou nom d&#39;utilisateur, avec pagination infinie et affichage dans un dropdown. Ce composant fait partie de l&#39;API Users de Vuemann. </p><h2 class="h2">Propriétés</h2><table class="t-default"><thead><tr><th>Nom</th><th>Type</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>modelValue</td><td>Object</td><td>Oui</td><td>-</td><td>Valeur liée au composant (v-model), contient la liste des utilisateurs trouvés.</td></tr><tr><td>groups</td><td>Boolean</td><td>Non</td><td>false</td><td>Indique si les groupes des utilisateurs doivent être inclus dans la recherche.</td></tr><tr><td>count</td><td>Number</td><td>Non</td><td>undefined</td><td>Nombre maximum d&#39;utilisateurs à retourner.</td></tr><tr><td>callback</td><td>Function</td><td>Non</td><td>undefined</td><td>Fonction de callback personnalisée pour la recherche. Si fournie, elle remplace les appels API par défaut.</td></tr></tbody></table><h2 class="h2">Méthodes exposées</h2><table class="t-default"><thead><tr><th>Nom</th><th>Paramètres</th><th>Description</th></tr></thead><tbody><tr><td>toggleDropdown</td><td>state (Boolean)</td><td>Ouvre ou ferme le dropdown des résultats de recherche.</td></tr><tr><td>setSearch</td><td>state (String)</td><td>Définit la valeur de recherche dans le champ.</td></tr></tbody></table><h2 class="h2">Fonctionnalités</h2><ul class="list ml-25"><li>Recherche par nom complet ou nom d&#39;utilisateur (bouton switch)</li><li>Pagination infinie pour charger plus de résultats</li><li>Dropdown avec affichage des résultats</li><li>Slot personnalisable pour l&#39;affichage des utilisateurs</li><li>Validation avec pattern regex</li><li>Gestion des erreurs intégrée</li><li>Intégration avec l&#39;API Users backend</li></ul><h2 class="h2">Exemples</h2><h3 class="h3">Utilisation de base</h3>',10)),l("div",W,[f(Q,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value=r),callback:n},{default:b(()=>[(v(!0),g(V,null,O(a.value,r=>(v(),g("li",{key:r.id,class:"p-5 bg-light border-radius-5"},N(r.fullname)+" ("+N(r.username)+") ",1))),128))]),_:1},8,["modelValue"])]),e[3]||(e[3]=l("p",null,[l("i",{class:"fa-solid fa-info-circle color-danger"}),F(" Dans cette page de démonstration, les données utilisateurs sont simulées. Le composant utilise un callback personnalisé pour éviter d'avoir besoin des routes API protégées. Nom de famille disponible: Martin, Dubois. ")],-1)),e[4]||(e[4]=l("h2",{class:"h2"},"Code",-1)),e[5]||(e[5]=l("h3",{class:"h3"},"Utilisation de base",-1)),f(E,null,{default:b(()=>[...e[1]||(e[1]=[l("scriptBalise",null," import UserSearch from '@brugmann/vuemann/src/apis/users/views/UserSearchComponent.vue'; import { ref } from 'vue'; const selectedUsers = ref([]); ",-1),l("template",null,[l("UserSearch",{vmodel:"selectedUsers"},[l("li",{"v-for":"user in selectedUsers",":key":"user.id",class:"p-5 bg-light border-radius-5"}," {{ user.fullname }} ({{ user.username }}) ")])],-1)])]),_:1})],64))}};export{le as default};
